<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Fresa</title>
    <link rel="stylesheet" href="calendario-fresa.css">
</head>
<body>
    <div class="calendario-container">
        <div class="strawberry strawberry-top-left"></div>
        <div class="strawberry strawberry-top-center-left"></div>
        <div class="strawberry strawberry-top-center-right small"></div>
        <div class="strawberry strawberry-top-right"></div>

        <div class="month-banner">
            <span id="mes-anio-actual">Abril 2025</span>
        </div>

        <div class="calendar-grid-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Dom</th>
                        <th>Lun</th>
                        <th>Mar</th>
                        <th>Mié</th>
                        <th>Jue</th>
                        <th>Vie</th>
                        <th>Sáb</th>
                    </tr>
                </thead>
                <tbody id="dias-calendario">
                    </tbody>
            </table>
        </div>

        <div class="decorative-tape"></div>
    </div>

    <div class="dia-info">
        <h3 id="dia-seleccionado-titulo">Selecciona un día</h3>
        <textarea id="nota-dia" placeholder="Escribe aquí tu nota para este día..."></textarea>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mesAnioActualDisplay = document.getElementById('mes-anio-actual');
            const diasCalendarioBody = document.getElementById('dias-calendario');
            const diaSeleccionadoTitulo = document.getElementById('dia-seleccionado-titulo');
            const notaDiaTextarea = document.getElementById('nota-dia');

            let fechaActual = new Date(2025, 3, 1); // Empezamos en Abril 2025 (mes 3 es Abril)

            function generarCalendario(anio, mes) {
                mesAnioActualDisplay.textContent = `${obtenerNombreMes(mes)} ${anio}`;
                diasCalendarioBody.innerHTML = ''; // Limpiar días anteriores

                const primerDiaDelMes = new Date(anio, mes, 1);
                const ultimoDiaDelMes = new Date(anio, mes + 1, 0);
                const totalDiasEnMes = ultimoDiaDelMes.getDate();
                const diaSemanaPrimerDia = primerDiaDelMes.getDay(); // 0 (domingo) a 6 (sábado)

                let dia = 1;
                for (let i = 0; i < 6; i++) { // Max 6 filas para cubrir todos los días
                    const fila = document.createElement('tr');
                    for (let j = 0; j < 7; j++) { // 7 días de la semana
                        const celda = document.createElement('td');
                        if (i === 0 && j < diaSemanaPrimerDia) {
                            // Celdas vacías antes del primer día del mes
                            celda.textContent = '';
                        } else if (dia <= totalDiasEnMes) {
                            // Días del mes
                            celda.innerHTML = `<div class="day-number">${dia}</div><div class="note-indicator"></div>`;
                            celda.dataset.dia = dia; // Almacenar el día para referencia
                            celda.dataset.mes = mes;
                            celda.dataset.anio = anio;

                            // Marcar el día actual si aplica
                            const hoy = new Date();
                            if (dia === hoy.getDate() && mes === hoy.getMonth() && anio === hoy.getFullYear()) {
                                celda.classList.add('dia-actual');
                            }

                            // Event listener para seleccionar el día y cargar/guardar notas
                            celda.addEventListener('click', function() {
                                // Remover clase 'selected-day' de cualquier celda previamente seleccionada
                                const selectedCell = document.querySelector('.calendar-grid-wrapper td.selected-day');
                                if (selectedCell) {
                                    selectedCell.classList.remove('selected-day');
                                }
                                // Añadir 'selected-day' a la celda actual
                                this.classList.add('selected-day');

                                const clickedDia = this.dataset.dia;
                                const clickedMes = this.dataset.mes;
                                const clickedAnio = this.dataset.anio;

                                diaSeleccionadoTitulo.textContent = `Nota para el ${clickedDia} de ${obtenerNombreMes(parseInt(clickedMes))} de ${clickedAnio}`;
                                // Cargar nota guardada
                                const notaGuardada = localStorage.getItem(`nota-${clickedAnio}-${clickedMes}-${clickedDia}`);
                                notaDiaTextarea.value = notaGuardada || '';
                            });
                            dia++;
                        } else {
                            // Celdas vacías después del último día del mes
                            celda.textContent = '';
                        }
                        fila.appendChild(celda);
                    }
                    diasCalendarioBody.appendChild(fila);
                    if (dia > totalDiasEnMes) break; // Salir del bucle si ya se añadieron todos los días
                }
            }

            function obtenerNombreMes(mes) {
                const nombres = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
                return nombres[mes];
            }

            // Guardar la nota cuando el usuario deja de escribir en el textarea
            notaDiaTextarea.addEventListener('blur', function() {
                const selectedCell = document.querySelector('.calendar-grid-wrapper td.selected-day');
                if (selectedCell) {
                    const dia = selectedCell.dataset.dia;
                    const mes = selectedCell.dataset.mes;
                    const anio = selectedCell.dataset.anio;
                    localStorage.setItem(`nota-${anio}-${mes}-${dia}`, this.value);

                    // Opcional: Mostrar el indicador de nota si hay texto
                    const noteIndicator = selectedCell.querySelector('.note-indicator');
                    if (noteIndicator) {
                         if (this.value.trim() !== '') {
                            noteIndicator.style.opacity = '1'; // Mostrar el punto
                        } else {
                            noteIndicator.style.opacity = '0'; // Ocultar el punto si no hay nota
                        }
                    }
                }
            });

            // Función para inicializar el calendario y cargar notas existentes para los indicadores
            function inicializarCalendarioConNotas() {
                generarCalendario(fechaActual.getFullYear(), fechaActual.getMonth());
                // Después de generar los días, verificar si hay notas guardadas para cada día
                diasCalendarioBody.querySelectorAll('td[data-dia]').forEach(celda => {
                    const dia = celda.dataset.dia;
                    const mes = celda.dataset.mes;
                    const anio = celda.dataset.anio;
                    const notaGuardada = localStorage.getItem(`nota-${anio}-${mes}-${dia}`);
                    const noteIndicator = celda.querySelector('.note-indicator');
                    if (noteIndicator && notaGuardada && notaGuardada.trim() !== '') {
                        noteIndicator.style.opacity = '1'; // Mostrar el punto si hay nota
                    }
                });
            }

            inicializarCalendarioConNotas(); // Generar el calendario por primera vez

            // Opcional: Añadir navegación de flechas si lo quieres (similar al ejemplo anterior)
            // Si no vas a usar flechas, podrías generar los 12 meses en una sola página.
            // Para el diseño de la imagen, una sola página por mes es más directa.
        });
    </script>
</body>
</html>